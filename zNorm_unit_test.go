// +build unit

package statsArb

import (
	"fmt"
	"log"
	"testing"
)

func TestZNorm(t *testing.T) {
	expected := []float64{
		-0.9499969481048066,
		-1.3582570180321076,
		-1.6304303979836416,
		-1.4943437080078747,
		0.2747832616770964,
		-1.7665170879594088,
		0.4108699516528634,
		0.1386965717013294,
		-0.5417368781775056,
		-2.0386904679109428,
		-0.5417368781775056,
		-1.2221703280563407,
		1.7717368514105334,
		0.6830433316043975,
		0.4108699516528634,
		-0.6778235681532726,
		1.0913034015316985,
		0.1386965717013294,
		-0.1334768082502046,
		1.3634767814832325,
		-1.0860836380805736,
		1.4995634714589994,
		-0.40565018820173865,
		-1.3582570180321076,
		-0.6778235681532726,
		0.1386965717013294,
		-0.40565018820173865,
		-0.9499969481048066,
		0.2747832616770964,
		-0.5417368781775056,
		-2.4469505378382435,
		-2.583037227814011,
		-1.4943437080078747,
		0.2747832616770964,
		-0.5417368781775056,
		1.0913034015316985,
		-0.5417368781775056,
		1.2273900915074654,
		-1.4943437080078747,
		-1.4943437080078747,
		1.2273900915074654,
		-0.8139102581290396,
		0.4108699516528634,
		1.2273900915074654,
		-1.0860836380805736,
		1.3634767814832325,
		0.6830433316043975,
		0.4108699516528634,
		0.5469566416286304,
		-0.40565018820173865,
		0.8191300215801645,
		-0.6778235681532726,
		-0.9499969481048066,
		1.3634767814832325,
		0.002609881725562387,
		0.4108699516528634,
		-0.40565018820173865,
		-0.6778235681532726,
		-1.6304303979836416,
		-0.9499969481048066,
		-1.9026037779351757,
		0.4108699516528634,
		-1.0860836380805736,
		-0.8139102581290396,
		1.0913034015316985,
		0.2747832616770964,
		-0.40565018820173865,
		-1.3582570180321076,
		-0.40565018820173865,
		0.4108699516528634,
		0.1386965717013294,
		-0.40565018820173865,
		-1.4943437080078747,
		-2.0386904679109428,
		-1.6304303979836416,
		0.002609881725562387,
		0.5469566416286304,
		-0.1334768082502046,
		-0.8139102581290396,
		0.4108699516528634,
		0.5469566416286304,
		0.1386965717013294,
		-0.5417368781775056,
		-1.0860836380805736,
		-0.9499969481048066,
		1.9078235413863005,
		-0.8139102581290396,
		-1.3582570180321076,
		1.0913034015316985,
		-0.1334768082502046,
		-0.40565018820173865,
		-0.1334768082502046,
		0.6830433316043975,
		-1.0860836380805736,
		-0.8139102581290396,
		-1.2221703280563407,
		-0.9499969481048066,
		-0.5417368781775056,
		-0.5417368781775056,
		-1.0860836380805736,
		1.4995634714589994,
		-1.0860836380805736,
		-1.0860836380805736,
		-0.5417368781775056,
		-0.9499969481048066,
		-1.3582570180321076,
		0.002609881725562387,
		-1.0860836380805736,
		0.5469566416286304,
		-1.6304303979836416,
		0.5469566416286304,
		0.4108699516528634,
		1.6356501614347665,
		-1.0860836380805736,
		-0.6778235681532726,
		-0.9499969481048066,
		-0.26956349822597164,
		0.002609881725562387,
		2.1799969213378345,
		1.2273900915074654,
		-1.3582570180321076,
		-0.9499969481048066,
		-0.5417368781775056,
		-1.2221703280563407,
		-0.40565018820173865,
		0.6830433316043975,
		-0.5417368781775056,
		1.3634767814832325,
		-1.6304303979836416,
		-1.0860836380805736,
		-0.26956349822597164,
		-0.9499969481048066,
		0.002609881725562387,
		-0.1334768082502046,
		0.002609881725562387,
		-0.5417368781775056,
		-2.4469505378382435,
		-1.0860836380805736,
		0.1386965717013294,
		-0.8139102581290396,
		1.7717368514105334,
		-0.1334768082502046,
		0.4108699516528634,
		-0.1334768082502046,
		-0.6778235681532726,
		0.1386965717013294,
		-0.40565018820173865,
		-1.2221703280563407,
		0.1386965717013294,
		-0.26956349822597164,
		-0.5417368781775056,
		0.4108699516528634,
		0.5469566416286304,
		-1.0860836380805736,
		-0.9499969481048066,
		0.8191300215801645,
		1.2273900915074654,
		-0.8139102581290396,
		-1.2221703280563407,
		0.5469566416286304,
		0.002609881725562387,
		0.8191300215801645,
		-1.0860836380805736,
		-0.1334768082502046,
		-0.9499969481048066,
		-0.26956349822597164,
		-1.0860836380805736,
		-1.6304303979836416,
		-0.8139102581290396,
		-0.26956349822597164,
		-0.40565018820173865,
		0.4108699516528634,
		-0.5417368781775056,
		0.6830433316043975,
		-1.2221703280563407,
		-1.6304303979836416,
		0.002609881725562387,
		0.1386965717013294,
		-0.1334768082502046,
		-0.1334768082502046,
		2.3160836113136014,
		0.1386965717013294,
		0.4108699516528634,
		-0.5417368781775056,
		-0.6778235681532726,
		0.4108699516528634,
		0.002609881725562387,
		2.0439102313620676,
		0.5469566416286304,
		1.2273900915074654,
		-0.1334768082502046,
		0.6830433316043975,
		-2.1747771578867097,
		-0.9499969481048066,
		0.2747832616770964,
		-0.1334768082502046,
		0.002609881725562387,
		-0.8139102581290396,
		0.4108699516528634,
		0.4108699516528634,
		0.4108699516528634,
		0.6830433316043975,
		-0.5417368781775056,
		0.002609881725562387,
		-0.9499969481048066,
		-0.8139102581290396,
		-0.40565018820173865,
		0.4108699516528634,
		0.1386965717013294,
		0.6830433316043975,
		-0.8139102581290396,
		-0.1334768082502046,
		1.0913034015316985,
		-0.40565018820173865,
		-0.1334768082502046,
		0.5469566416286304,
		2.9965170611924363,
		0.4108699516528634,
		-1.0860836380805736,
		-0.5417368781775056,
		0.2747832616770964,
		0.8191300215801645,
		0.5469566416286304,
		0.2747832616770964,
		-0.6778235681532726,
		-0.40565018820173865,
		0.2747832616770964,
		0.4108699516528634,
		-1.2221703280563407,
		0.2747832616770964,
		-0.5417368781775056,
		0.5469566416286304,
		0.5469566416286304,
		-0.26956349822597164,
		-0.40565018820173865,
		0.2747832616770964,
		0.8191300215801645,
		1.0913034015316985,
		-0.1334768082502046,
		0.002609881725562387,
		1.2273900915074654,
		-0.1334768082502046,
		0.2747832616770964,
		-0.5417368781775056,
		3.5408638210955043,
		-0.26956349822597164,
		0.002609881725562387,
		1.2273900915074654,
		0.2747832616770964,
		0.4108699516528634,
		-0.8139102581290396,
		2.0439102313620676,
		0.2747832616770964,
		0.002609881725562387,
		1.4995634714589994,
		0.002609881725562387,
		-1.0860836380805736,
		-0.26956349822597164,
		1.9078235413863005,
		0.2747832616770964,
		1.4995634714589994,
		1.7717368514105334,
		-0.40565018820173865,
		2.3160836113136014,
		1.7717368514105334,
		4.22129727097434,
		1.7717368514105334,
		0.2747832616770964,
		0.1386965717013294,
		-0.26956349822597164,
		0.6830433316043975,
		1.2273900915074654,
		1.9078235413863005,
		0.9552167115559315,
		1.6356501614347665,
		1.9078235413863005,
		0.6830433316043975,
		0.2747832616770964,
		0.1386965717013294,
		0.002609881725562387,
		0.4108699516528634,
		1.0913034015316985,
		0.8191300215801645,
		0.1386965717013294,
		-0.26956349822597164,
		2.3160836113136014,
		-0.1334768082502046,
		0.002609881725562387,
		1.2273900915074654,
		0.9552167115559315,
		0.4108699516528634,
		0.1386965717013294,
		0.002609881725562387,
		-0.5417368781775056,
		0.6830433316043975,
		-0.5417368781775056,
		-0.8139102581290396,
		0.002609881725562387,
		-0.9499969481048066,
		-1.9026037779351757,
		0.2747832616770964,
		-0.8139102581290396,
		0.4108699516528634,
		0.5469566416286304,
		0.8191300215801645,
		0.9552167115559315,
		0.1386965717013294,
		0.002609881725562387,
		2.3160836113136014,
		0.4108699516528634,
		1.3634767814832325,
		0.5469566416286304,
		0.002609881725562387,
		-0.26956349822597164,
		-0.26956349822597164,
		0.4108699516528634,
		-0.9499969481048066,
		-0.9499969481048066,
		-0.26956349822597164,
		-0.40565018820173865,
		-1.2221703280563407,
		0.002609881725562387,
		0.6830433316043975,
		1.2273900915074654,
		0.2747832616770964,
		-0.26956349822597164,
		2.0439102313620676,
		0.9552167115559315,
		0.4108699516528634,
		0.9552167115559315,
		1.2273900915074654,
		0.5469566416286304,
		0.2747832616770964,
		1.3634767814832325,
		0.4108699516528634,
		-1.3582570180321076,
		0.5469566416286304,
		-0.1334768082502046,
		-1.0860836380805736,
		-1.2221703280563407,
		-0.8139102581290396,
		0.9552167115559315,
		0.1386965717013294,
		0.1386965717013294,
		-1.0860836380805736,
		-0.40565018820173865,
		-0.9499969481048066,
		1.3634767814832325,
		0.6830433316043975,
		1.3634767814832325,
		-0.40565018820173865,
		-0.26956349822597164,
		0.002609881725562387,
		0.002609881725562387,
		1.4995634714589994,
		-0.40565018820173865,
		-0.26956349822597164,
		-0.5417368781775056,
		0.2747832616770964,
		-1.0860836380805736,
		-0.6778235681532726,
		1.3634767814832325,
		0.8191300215801645,
		1.7717368514105334,
		1.0913034015316985,
	}

	data, err := fetchFemaleBirthsData()
	if err != nil {
		t.Fatalf("failed to load birth data\n%v", err)
	}

	zData, err := ZNorm(data)
	if err != nil {
		t.Fatalf("failed to calc znorm\n%v", err)
	}
	log.Println(len(zData), len(expected))
	if zData == nil || len(zData) != len(data) || len(zData) != len(expected) || len(data) == 0 {
		t.Fatal("invalid zData")
	}

	for idx := range zData {
		if fmt.Sprintf("%.4f", zData[idx]) != fmt.Sprintf("%.4f", expected[idx]) {
			t.Errorf("expected %s, received %s", fmt.Sprintf("%.4f", zData[idx]), fmt.Sprintf("%.4f", expected[idx]))
		}
	}
}
